<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shekinah's @18 RSVP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Montserrat', sans-serif;
  background: url('https://i.imgur.com/AUfRfam.jpeg') no-repeat center center fixed;
  background-size: cover;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  position: relative;
}
body::before {
  content: "";
  position: absolute;
  top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.45);
  z-index:0;
}

.card {
  position: relative;
  z-index:1;
  background: rgba(255,255,255,0.95);
  max-width:450px;
  width:90%;
  padding:35px;
  border-radius:20px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.30);
  text-align:center;
  color: #4b0000;
}

h1 {
  font-family: 'Great Vibes', cursive;
  font-size: 3rem;
  color:#800000;
  margin-bottom:10px;
}

p { font-size:1rem; margin-bottom:20px; }

.input-container { display:flex; gap:10px; margin-bottom:15px; }
.input-container input { flex:1; }

input, select, button { padding:14px; border-radius:12px; border:1px solid #800000; font-size:16px; }
input:focus, select:focus { outline:none; border:2px solid #a00000; box-shadow:0 0 10px rgba(160,0,0,0.3);}
button { background:#800000; color:#fff; font-weight:600; cursor:pointer; transition:0.3s; }
button:hover { background:#a00000; box-shadow:0 5px 15px rgba(160,0,0,0.4); }

.hidden { display:none; }
#message { font-weight:600; margin:15px 0; font-size:1rem; }
#thankYouCard { display:none; background:#fff8f8; padding:25px; border-radius:15px; margin-top:20px; color:#800000; font-size:1.2rem; font-weight:600; opacity:0; transform:translateY(20px); transition:all 0.7s ease;}
#thankYouCard.show { display:block; opacity:1; transform:translateY(0); }

@media screen and (max-width:480px){
  .card { max-width:320px; padding:25px; }
  h1 { font-size:2.2rem; }
  input, select, button { padding:12px; font-size:15px; }
  #thankYouCard { font-size:1rem; padding:20px; }
  .input-container { flex-direction:column; }
  .input-container button { width:100%; }
}
</style>
</head>

<body>

<div class="card">
  <h1>Shekinah's @18</h1>
  <p>Please enter your full name to RSVP</p>

  <div class="input-container">
    <input type="text" id="guestName" placeholder="Full Name">
    <button onclick="searchGuest()">Search</button>
  </div>

  <p id="message"></p>

  <form id="rsvpForm" class="hidden">
    <div id="groupList"></div>
    <button type="submit">Confirm RSVP</button>
  </form>

  <div id="thankYouCard"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby3Tt9uI-kzyENfN0A3klAflL7BuKKxVcloxriI8FjIlKjn9T86tKKMtNDFIR-WHlNt/exec"; // replace with your Apps Script URL

function searchGuest(){
  const name = document.getElementById("guestName").value.trim();
  const message = document.getElementById("message");
  const form = document.getElementById("rsvpForm");
  const groupList = document.getElementById("groupList");
  const thankYouCard = document.getElementById("thankYouCard");

  groupList.innerHTML = "";
  thankYouCard.classList.remove("show");
  message.innerText = "";

  if(!name){ message.innerText = "Please enter your name."; return; }

  fetch(SCRIPT_URL + "?name=" + encodeURIComponent(name))
    .then(res=>res.json())
    .then(data=>{
      if(data.found){
        let html = "";
        data.group.forEach(member=>{
          html += `
            <div style="margin-bottom:10px;text-align:left;">
              <label>${member.name}</label>
              <select name="attendance" data-name="${member.name}" required>
                <option value="">Will you attend?</option>
                <option value="Yes">Yes, I will attend</option>
                <option value="No">Sorry, I can't attend</option>
              </select>
            </div>
          `;
        });
        groupList.innerHTML = html;
        form.classList.remove("hidden");
        message.innerText = "Please confirm attendance for your group.";
      } else {
        message.innerText = "Name not on the guest list.";
        form.classList.add("hidden");
      }
    })
    .catch(()=>{ message.innerText = "Error connecting to server."; });
}

document.getElementById("rsvpForm").addEventListener("submit", function(e){
  e.preventDefault();
  const selects = document.querySelectorAll('#groupList select');
  const groupData = [];

  selects.forEach(s=>{
    groupData.push({name: s.dataset.name, attendance: s.value});
  });

  // Validate all
  for(let i=0;i<groupData.length;i++){
    if(!groupData[i].attendance){
      alert("Please select attendance for all members.");
      return;
    }
  }

  fetch(SCRIPT_URL, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({group: groupData})
  })
  .finally(()=>{
    document.getElementById("rsvpForm").classList.add("hidden");
    document.getElementById("message").innerText = "";
    const thankYouCard = document.getElementById("thankYouCard");
    let attending = groupData.filter(g=>g.attendance==="Yes");
    if(attending.length>0){
      thankYouCard.innerText = "Thank you for attending Shekinah's @18!";
    } else {
      thankYouCard.innerText = "Thank you for letting us know. Sorry you can't attend Shekinah's @18.";
    }
    thankYouCard.style.display = "block";
    setTimeout(()=>{ thankYouCard.classList.add("show"); },50);
  });
});
</script>

</body>
</html>
